<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<app-notification></app-notification>
<div class="wrappers">
    <div class="sidenav">
        <h2>Branch Report Parameters</h2>
        <hr>
        <form [formGroup]="filterForm">
            <h4>Date Range</h4>
            <div>
                <mat-form-field appearance="fill">
                    <mat-label>Start Date</mat-label>
                    <input matInput [matDatepicker]="picker1" formControlName="startDate" class="form-control">
                    <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                    <mat-datepicker #picker1></mat-datepicker>
                </mat-form-field>
                <mat-form-field appearance="fill">
                    <mat-label>End Date</mat-label>
                    <input matInput [matDatepicker]="picker" formControlName="endDate" class="form-control">
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>
            </div>
            <br>
            <h4>Branch</h4>
            <mat-form-field appearance="fill">
                <mat-label>Branch</mat-label>
                <mat-select formControlName="BranchId">
                    <mat-option *ngFor="let item of categoryData" [value]="item.BranchId">
                        {{item.BranchName}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <hr><br>
            <button class="button" style="background-color: powderblue;" type="submit"
                (click)="generateReport(filterForm.value)">Generate Report</button><br><br>
            <button class="button" style="background-color: pink;" (click)="openPDF()">Download Report PDF</button>
        </form>
    </div>
    <br>
    <div *ngIf="created" style="width:70%; left:200px;" id="content">
        <table>
            <tr style="border: none;">
                <th class="header"></th>
                <th class="center-head"></th>
                <th class="right-head"></th>
            </tr>
            <tr>
                <td>
                    <h2>Report Date: <b> {{ date | date: 'dd/MM/y'}}</b></h2>
                    <h2>Branch: <b>{{branchName}}</b></h2>
                </td>
                <td><img class="img-header" src="../../../../assets/images/Food works.jpg"></td>
                <td>
                    <h2>Date Range</h2>
                    <h3>Start Date: <b> {{reportParams.startDate | date: 'dd/MM/y'}} </b> </h3>
                    <h3>End Date: <b> {{reportParams.endDate | date: 'dd/MM/y'}} </b> </h3>
                </td>
            </tr>
        </table>
        <hr class="hr-header">
        <h1 class="h1-header">Branch Report</h1>
        <hr>
        <h3>Number of completed Branch Requests <b style="float:right;">{{complete}}</b></h3>
        <h3>Number of outstanding Branch Requests <b style="float:right;">{{incomplete}}</b></h3>
        <hr>
        <h3>Total number of requests: <b style="float:right;">{{total}}</b></h3>
        <hr>
        <h1 style="text-align: center;">Branch Requests</h1>
        <mat-card *ngFor="let date of requests;">
            <h3>Request Date: <b>{{date.Date |date: 'dd/MM/y'}}</b></h3>
            <h3>Request Description: <b>{{date.Status.requestStatusDescription}}</b> </h3>
            <table id=daily-sales-table style="font-size:small;">
                <tr>
                    <th>Requested Product ID</th>
                    <th>Product Name</th>
                    <th>Requested Quantity</th>
                </tr>
                <tr *ngFor="let item of date.RequestLines; let j = index;">
                    <td>{{item.ProductId}}</td>
                    <td>{{item.ProductName}}</td>
                    <td>{{item.Quantity}}</td>
                </tr>
            </table>
        </mat-card>
        <br>
        <hr>
        <h2 style="text-align: center;">Request Averages</h2>
        <h2>Average number of products requested per Branch Request: <b style="float:right;">{{avgRequestLines}}
                products per request </b>
        </h2>
        <h2>Average quantity requested per product: <b style="float:right;"> {{avgQRequested}} units </b></h2>
        <hr>

        <h2 style="text-align: center;">Current Branch Stock</h2>
        <hr>
        <div class="chart-wrapper" id="htmlData">
            <canvas height="24" width="70" baseChart [datasets]="barChartData" [labels]="barChartLabels"
                [options]="barChartOptions" [plugins]="barChartPlugins" [legend]="barChartLegend"
                [chartType]="barChartType">
            </canvas>
        </div>
        <h2 class="center-head">** END OF REPORT **</h2>
        <hr>
        <div class="left-footer">
            <h4>Generated by: </h4><img class="img-footer" src="../../../../assets/images/LOGO 2 FINAL.JPG">
        </div>
        <div class="right-footer">
            <h4>Page 1 of 1</h4>
        </div>
    </div>
    <br>
</div>